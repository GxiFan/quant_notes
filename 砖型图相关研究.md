# renko图（砖形图学习笔记）

## 目录
- [renko图简介](#renko图简介)
- [Renko图基础资料学习](#renko图基础资料学习)
  - [Renko图的基础](#renko图的基础)
    - [砖块计算方法](#砖块计算方法)
  - [技术分析理论](#技术分析理论)
- [renko图相关项目搜集](#renko图相关项目搜集)
  - [项目来源及简要介绍](#项目来源及简要介绍)
  - [交易思路及策略借鉴](#交易思路及策略借鉴)
  - [待尝试目标策略](#待尝试目标策略)
- [铁矿石、豆油、豆粕期货数据的renko图处理](#铁矿石豆油豆粕期货数据的renko图处理)
  - [分钟线数据](#分钟线数据)
  - [砖块刻度分析](#砖块刻度分析)
  - [趋势分析](#趋势分析)
- [工具选择及回测](#工具选择及回测)
  - [python库工具选择及简要介绍](#python库工具选择及简要介绍)
  - [回测指标](#回测指标)
  - [策略回测效果](#策略回测效果)



## Renko图基础资料学习
### Renko图的基础
Renko 图是一种只关注价格运动的图表类型，其名称源自日语“renga”，意为“砖块”。Renko 图通过构造一系列砖块来过滤掉市场的噪音，专注于价格的显著变动。

- **砖块生成条件**  
  - 预先定义砖块的大小，当价格运动超过该预设“砖块大小”时，即在当前砖块的上方或下方生成一个新的砖块。  
  - 即使价格超过前一个砖块的范围，新砖块也仅以预定边界终止，而不会延伸出超出设定范围的部分。

- **砖块放置规则**  
  1. 砖块的角始终接触。  
  2. 每一根垂直列中只能生成一块砖。

---

Renko 图中存在四种砖块类型，分别为：

1. **向上砖（Up Bricks）**  
   - 位于前一砖块之上，当价格上涨达到足够幅度时生成。

2. **向下砖（Down Bricks）**  
   - 位于前一砖块之下，当价格下跌达到足够幅度时生成。

3. **向上预示砖（Projection Up Bricks）**  
   - 在日内时间框架内，根据当前价格运动推测出可能生成的向上砖，但实际尚未形成。

4. **向下预示砖（Projection Down Bricks）**  
   - 同理，根据当前价格走势推测出可能生成的向下砖。
#### 砖块计算方法

Renko 图的砖块大小可以通过三种方法来确定：

1. **平均真实波幅（ATR）方法**  
   - 利用 ATR 指标计算出的波动性来自动确定合适的砖块大小，从而过滤掉普通的市场噪音。

2. **传统方法**  
   - 预先定义固定数值作为砖块大小，只有当价格运动超过这个绝对值时，才生成新砖。  
   - 常见建议是将砖块大小设为交易工具当前价格的1/20。

3. **百分比（LTP）方法**  
   - 以最新交易价格的一定百分比来计算砖块大小，该方法会将百分比值转化为具体价格，并向最小价格刻度四舍五入。  
   - 需要注意的是，此方法具有重绘（repainting）的风险。
准确计算 Renko 砖块需要较高频（tick）数据，为了折衷，参考资料中使用固定时间段的收盘价或 OHLC 数据来生成砖块。
注：OHLC 数据是一种常用的金融市场数据格式，用于描述每个时间周期内的价格行为。OHLC 分别代表：

- **O (Open, 开盘价)：**  
  指该时间周期内第一笔成交的价格。开盘价通常反映了市场在开盘时的情绪和走势预期。

- **H (High, 最高价)：**  
  指该时间周期内达成交易的最高价格。最高价可以显示市场在交易时段内的极端买盘力量。

- **L (Low, 最低价)：**  
  指该时间周期内达成交易的最低价格。最低价反映了市场在该时段内遭遇的抛压情况。

- **C (Close, 收盘价)：**  
  指该时间周期内最后一笔成交的价格。
---
参考资料：
1、 https://www.tradingview.com/support/solutions/43000502284-renko-charts/
2、15年经验交易员：我是如何利用“砖形图”来攫取利润的 - 汇商传媒的文章 - 知乎
https://zhuanlan.zhihu.com/p/112998867

### 技术分析理论

#### renko图常用于以下几方面：

- **支撑与阻力识别**  
  - 在技术分析中，识别关键的支撑位和阻力位对制定交易决策、风险管理以及寻找入场/出场点至关重要。以下有几种常用且具备定量特征的方法（带时间和不带时间都有，感觉可以推广到renko图）：
    
    - 历史价格拐点法：

        **思路：**  
        利用历史价格图表中明显的局部低点（支撑）和局部高点（阻力）作为关键水平。  
        
        **定量步骤：**  
        - **局部极值检测：**  
        可以采用滑动窗口算法，在一定周期内（例如10日、20日）寻找局部最高点和最低点；  
        - **统计验证：**  
        统计每个关键水平被价格触及和反转的次数，次数越多则该水平越重要。例如，当某一价格点被测试 3 次及以上时，可视作较强的支撑或阻力


    - 枢轴点（Pivot Points）

        枢轴点是一种基于前一交易时段价格数据计算出中心值及其支撑、阻力水平的定量方法。
    
        **计算公式：**

        - **中心枢轴点 (P)：**  
        P = (H + L + C) / 3

        - **第一阻力位 (R1) 与第一支撑位 (S1)：**  
        R1 = 2 × P - L  
        S1 = 2 × P - H

        - **第二阻力位 (R2) 与第二支撑位 (S2)：**  
        R2 = P + (H - L)  
        S2 = P - (H - L)

        其中，H、L、C 分别表示前一交易时段的最高价、最低价与收盘价。该方法可以较为直观地给出当日的关键价位，可在日内交易中广泛应用。
    - 斐波那契回撤法

        利用价格区间内斐波那契比例构建支撑与阻力位，常用于趋势中的回调区域。  

        **定量方法：**

        1. **确定区间：**  
        选定近期一段明显的上升趋势（或下降趋势）的最高点和最低点。

        2. **计算回撤价位：**  
        对于上升趋势：  
        - 支撑位 = 高点 - 比例 × (高点 - 低点)  
        对于下降趋势：  
        - 阻力位 = 低点 + 比例 × (高点 - 低点)

        常用的比例有 38.2%、50% 和 61.8%。
    - 移动平均线法

        利用移动平均线 (MA) 作为动态支撑和阻力水平。短期 MA 和长期 MA 均可作为价格关键水平，通过计算一定周期内的平均收盘价来平滑数据。

        **应用要点：**  
        - 常用的均线如 20 日、50 日或 200 日 MA；  
        - 当价格反复触及某一均线后，该均线可作为支撑（或阻力）；  
        - 可以结合均线斜率和偏离程度，通过标准差或相对位置（如价格与 MA 的百分比距离）来进行定量判断。

    - 布林带
        布林带基于移动平均线和标准差构造，其上下轨分别近似于短期的阻力与支撑水平。  
    
        **计算公式：**

        - 中轨 = MA (通常取20日简单移动平均)  
        - 上轨 = MA + K × σ  
        - 下轨 = MA - K × σ  

        其中，σ 为选定周期内的价格标准差，K 通常取2。当价格接近上轨或下轨时，可视为潜在的阻力或支撑。

- **突破信号**  
  - 当价格突破原有支撑或阻力区域后，砖块将连贯生成，帮助捕捉趋势的起始点。
    价格幅度突破法

    **基本思路：**  
    确定关键支撑或阻力位后，观察价格是否在某个时间周期内“突破”该水平，且突破幅度达到预定标准。

    **定量标准：**  
    - 对于阻力位，若收盘价超过阻力位的百分比突破幅度：
    ```math
    \frac{C - R}{R} \geq \alpha
    ```
    - 对于支撑位，则要求：
    ```math
    \frac{S - C}{S} \geq \alpha
    ```
    其中，α是突破幅度阈值，一般可以设定在0.5%～2%之间。

    **举例：**
    如果阻力位在100元，当日收盘价达到102元，则百分比突破为
    ```math
    \frac{102 - 100}{100} = 2\%
    ```
    如果交易者设定α = 1%，则该突破信号可以认为有效。 

    - 技术指标辅助
    布林带、移动平均线、RSI、MACD等指标，也可用来量化判断突破信号。例如：

        - **布林带：** 当价格突破布林带上轨或下轨，同时% b指标超过1或低于0，说明价格已脱离波动区间。
        - **RSI指标：** RSI 若在突破时处于超买（>70）或超卖（<30）区域，可以进一步确认市场力量的转变。
        - **MACD指标：** 当 MACD 线向上突破信号线且同步突破关键水平时，也可视为买入突破信号；反之则为卖出信号。



## renko图相关项目搜集（持续补充）
直接介绍砖型图的书和文章并不多，这里选择在github中搜索使用砖型图的项目进行分析，吸收项目主要思想，提炼交易策略，后续基于这里整理的交易策略进行回测。
### 项目来源及简要介绍

- https://github.com/ntalegeofrey/Dynamic-Renko-Trading-Strategy
使用从加密货币交易所获取的历史价格数据实现Renko交易策略。
    
- https://github.com/fmzquant/strategies?search=1 包含各种量化交易策略的思路和实现，我们这里选择和renko图相关的几个交易策略进行学习：
    - Renko反转价格突破交易策略Renko-Reversal-Price-Breakout-Trading-Strategy：
        该策略通过Renko线图形态分析，判断价格可能反转的时间点，在突破关键价格时入场。
        
        策略运作原理：
        - 使用Renko线图(Renko Bar)，显示价格走势
        - 分析Renko线前4根K线的收盘价与开盘价关系
        - 当前4根线的收盘价出现显著反转信号时，判断趋势可能反转
        - 当Renko线的收盘价突破开盘价时，产生交易信号

        具体交易规则:
        - 如果最近4根Renko线收盘价出现较大上涨,而当前收盘价又低于开盘价,则做空。
        - 如果最近4根Renko线收盘价出现较大下跌,而当前收盘价又高于开盘价,则做多。
        - 入场后使用固定交易量进行交易。

    
    - Renko反转追踪策略Renko-Reversal-Tracking-Strategy：

        Renko反转追踪策略是一种利用Renko图形来判断市场反转的短线策略。它通过监控相邻Renko颜色的变化来捕捉短期反转机会。当出现连续同色Renko后下一Renko变色时产生交易信号。该策略核心为抓住Renko颜色反转造成的短期回调机会。连续同色Renko代表趋势形成,下一Renko变色预示可能的反转。Renko大小和止盈止损系数可调整以优化策略效果。
        
        策略运作原理和规则：
        - 使用传统不修复Renko。
        - 监控相邻两Renko的颜色变化。
        - 当前一Renko和前两Renko颜色相同,当前Renko颜色反转时,产生信号。
        - 做多信号:两阴砖后出现一阳砖,看涨;
        - 做空信号:两阳砖后出现一阴砖,看跌。
        - 入场方式可选择市价单或止损单。
        - 设置止盈止损点位为Renko大小的一定倍数。

    - K线Stochastic-RSI交易策略Renko-Stochastic-RSI-Trading-Strategy，ChaoZhang：

        该策略是一种适用于砖块K线的Stochastic RSI交易策略。它使用Stochastic RSI指标的K线和D线的金叉死叉来产生买入和卖出信号。该策略专门用于砖块K线,可以有效过滤市场噪音,识别趋势。

        策略运作原理：

        该策略的交易信号主要基于Stochastic RSI指标,该指标结合了RSI指标和Stochastic oscillator指标的优点。

        首先,计算一段时间内的RSI值,然后再根据RSI值计算Stochastic RSI。Stochastic RSI包含两个线:

        K线:计算一定周期RSI的移动平均,代表Stochastic RSI的快线


        D线:K线的移动平均,代表Stochastic RSI的慢线


        当K线从下向上突破D线时,产生买入信号;当K线从上向下突破D线时,产生卖出信号。

        此外,该策略仅用于砖块K线图,可以过滤掉市场噪音,识别趋势方向。砖块K线通过设置价格变动阈值构建K线,能够过滤正常市场波动对交易的影响。

        风险及分析：
        
        误判风险导致亏损

        - 优化Stochastic RSI的参数

        - 结合其他指标进行确认

        趋势反转时错误持仓被套牢

        - 设置止损止盈条件

        砖块K线范围设置不当失去效果

        - 对砖块K线的参数进行测试优化
        过于频繁交易增加交易费用和滑点成本

            调整砖块K线的设置,减少交易频率

        优化方向：

        优化Stochastic RSI的参数,找到最佳配置

        优化砖块K线的参数设置

        加入止损止盈策略

        结合其他指标进行信号过滤

        应用机器学习算法提升交易时机判断

        根据市场情况调整参数

        进行参数自动优化测试

    - 久期均线交叉Renko策略Long-term-Moving-Average-Crossover-Renko-Strategy，ChaoZhang：

        该策略是基于Renko蜡烛图的移动平均线交叉策略。它使用TEMA指标构建交叉信号,并结合长期均线进行过滤,旨在识别Renko蜡烛图上的趋势,发出买入和卖出信号。

        
        策略原理：

        当短期TEMA上穿短期SMA时,做多;当短期TEMA下穿短期SMA时,平仓。

        该策略还设置了两个可选参数avg_protection和gain_protection,用于调节进场和止损逻辑:
        - avg_protection>0时,只有当close价格低于当前持仓均价时才会买入,这样可以降低持仓成本
        - gain_protection>0时,只有当close价格超过入场价一定百分比时才会卖出止盈,从而锁定盈利


        使用一条长期SMMA指标作为趋势过滤器。只有当close价格低于SMMA时,才会发出做多信号。

        优势：

        - 基于Renko蜡烛图,能有效过滤noise,识别趋势;
        - 使用TEMA指标构建信号,灵敏度高,跟随性好;
        - 可调参数丰富,可以控制进场策略;
        - 结合长短期均线,可在趋势中捕捉机会。
        
        风险：

        - Renko本身时间轴不均匀,无法控制间隔时间;
        - TEMA灵敏度高也更容易产生误信号;
        - 参数设置不当可能导致漏入漏出。

        优化方向：

        - 测试不同参数组合,寻找最优参数;
        - 增加止损策略,比如移动止损、区间止损等,降低 DD;
        - 结合其他指标进行信号过滤,减少误信号;
        - 测试不同品种的参数效果。
    - 克隆阴阳数量化交易策略Renko-Yin-Yang-Quant-Trading-Strategy，ChaoZhang：

        克隆阴阳数量化交易策略是一个基于日内量价关系的短线交易策略。该策略利用日内股票交易的阴阳方向信息,结合量能确认信号,实现低风险的短线操作。

        
        策略原理：

        该策略通过计算股票每日的开盘价、收盘价、最高价、最低价,结合ATR指标,生成Renko砖块。当阴阳砖块发生反转时产生交易信号。

        具体来说,策略首先计算Renko砖块的开盘价o2和收盘价c2。如果o2<c2,表示阳线,如果o2>c2,表示阴线。当阳线转为阴线时产生卖出信号,当阴线转为阳线时产生买入信号。

        为了过滤假突破,策略还统计了上一个阳线和阴线的周期数,如果阳线周期数较多,则信号更可靠。此外,策略还在买入和卖出后设置了止损止盈逻辑。

        优势：

        - 使用Renko砖块过滤了市场噪音,交易信号更清晰。
        - 结合量能关系,避免了假突破的风险。
        - DAPM模型简单有效,适合日内短线操作。
        - 可自定义ATR参数调整交易频率。
        - 可自定义止损止盈策略优化风险管理。
        
        风险：

        - 仍存在趋势不明显的假突破风险。
        - Renko参数设置不当可能错过趋势或增大交易频率。
        - 止损点设置过小可能造成轻微亏损被反弹止损。
        优化方向：

        - 可考虑结合其他技术指标过滤信号。
        - 可考虑增加移动止损或跟踪止损功能。
        - 可针对不同品种参数进行优化测试。
        - 可考虑不同时间周期的组合,进行多时间框架交易。

### 交易思路及策略借鉴思路

- 前两个策略是基准策略，在renko图中根据砖块的变化判断趋势和多空仓时机，可以先实现这两个策略进行基准回测
- 后面的策略混合了其他指标进行判断，需要补充学习相关内容，再分析优劣，用历史数据与基准策略进行测试




## 铁矿石、豆油、豆粕期货数据的renko图处理（待完成）
### 分钟线数据

### 砖块刻度分析

### 趋势分析


## 工具选择及回测（待完成）
### python库工具选择及简要介绍
### 回测指标
### 策略回测效果
---

*最后更新时间: [2025-04-15]* 
